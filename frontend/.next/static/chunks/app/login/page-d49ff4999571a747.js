(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{9589:function(e,t,a){Promise.resolve().then(a.bind(a,4338))},4338:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var l=a(3827),s=a(4090),n=a(7907),r=a(8792);function o(){let[e,t]=(0,s.useState)(""),[a,o]=(0,s.useState)(""),[d,i]=(0,s.useState)(""),[c,u]=(0,s.useState)([]),[h,m]=(0,s.useState)(null),[f,b]=(0,s.useState)(!1),[x,g]=(0,s.useState)(null),p=(0,n.useRouter)();(0,s.useEffect)(()=>{(async()=>{let e=await fetch("".concat("http://localhost:4000","/auth/check"));if(e.ok){var t;let a=await e.json();"object"==typeof a.dealerId&&(null===(t=a.dealerId)||void 0===t?void 0:t.id)?p.push("/dashboard?dealerId=".concat(a.dealerId.id)):("number"==typeof a.dealerId||"string"==typeof a.dealerId)&&p.push("/dashboard?dealerId=".concat(a.dealerId))}})()},[p]);let y=async()=>{try{let t=await fetch("".concat("http://localhost:4000","/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:a}),credentials:"include"});if(!t.ok){let e=await t.json();alert(e.message||"Login failed");return}let l=await t.json();console.log("CLIENT RECEIVED:",l),l.dealers.length>1&&"admin"!==l.role?(u(l.dealers),g(l.token),b(!0)):"admin"===l.role?await j(l.token,null):await j(l.token,l.dealers[0].id)}catch(e){console.error(e),alert("Unexpected login error: ".concat(e))}},j=async(e,t)=>{null!=t&&await fetch("".concat("http://localhost:4000","/auth/select-dealer"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dealerId:t}),credentials:"include"}),window.location.href="/dashboard"};return(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:(0,l.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow p-8",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-center mb-6",children:"Login"}),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,l.jsx)("input",{type:"email",className:"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:e,onChange:e=>t(e.target.value)})]}),(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),(0,l.jsx)(r.default,{href:"/forgot-password",className:"text-sm text-blue-600 hover:underline",children:"Forgot password?"})]}),(0,l.jsx)("input",{type:"password",className:"w-full border border-gray-300 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",value:a,onChange:e=>o(e.target.value)})]}),d&&(0,l.jsx)("div",{className:"text-red-600 text-sm mb-4",children:d}),!f&&(0,l.jsx)("button",{onClick:y,className:"w-full bg-black text-white font-semibold py-2 rounded hover:bg-gray-800 transition",children:"Log in"}),f&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("label",{className:"block mb-1 font-medium",children:"Select your dealership"}),(0,l.jsxs)("select",{value:h||"",onChange:e=>{m(Number(e.target.value)),g(localStorage.getItem("token"))},className:"w-full p-2 border rounded",children:[(0,l.jsx)("option",{value:"",disabled:!0,children:"Select dealer"}),c.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,l.jsx)("button",{onClick:()=>{x&&h?j(x,h):alert("Please select a dealer")},className:"w-full bg-black text-white font-semibold py-2 rounded hover:bg-gray-800 transition",children:"Continue"})]}),(0,l.jsxs)("div",{className:"mt-6 text-center text-sm text-gray-600",children:["Donâ€™t have an account?"," ",(0,l.jsx)(r.default,{href:"/register",className:"text-blue-600 hover:underline",children:"Sign up"})]})]})})}}},function(e){e.O(0,[901,971,69,744],function(){return e(e.s=9589)}),_N_E=e.O()}]);